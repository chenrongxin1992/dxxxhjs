  

  <div class="col-md-12 col-sm-12 col-xs-12">
    <fieldset class="layui-elem-field layui-field-title">
      <legend>试卷列表</legend>
        <div class="layui-btn-group demoTable">
          <button class="layui-btn" data-type="newst" id="newst">新增试题</button>
        </div>
        <table id="sjlb_tb" lay-filter="sjlb_table"></table>
    </fieldset>
  </div>

  <script type="text/html" id="toolbar">
    <a class="layui-btn layui-btn-xs" lay-event="edit" style="color:#fff;">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" style="color:#fff;">删除</a>
  </script>

<script>
'use strict'
$(function(){
  layui.use(['form', 'laydate','layer','table'], function(){
    let laydate = layui.laydate,
        layer = layui.layer,
        form = layui.form,
        table = layui.table
    
    //执行实例
    table.render({
      elem: '#sjlb_tb'
      ,height: 'full-200'//高度最大化
      ,cellMinWidth: 50//列宽自动分配
      ,url: '/manage/sjlb_data' //数据接口
      ,page: true //开启分页
      ,id: 'reload_tb'
      ,cols:  [[ //标题栏
         {field: 'id', title: 'id', align: 'center'} //rowspan即纵向跨越的单元格数
        ,{field: 'ksname', title: '试卷主题', align: 'center'} //rowspan即纵向跨越的单元格数
        ,{field: 'ksriqi', title: '考试日期', align: 'center'}
        ,{field: 'ksshijian', title: '考试时间(分钟)', align: 'center'}
        ,{field: 'danxuan_num', title: '单选题', align: 'center'}
        ,{field: 'duoxuan_num', title: '多选题', align: 'center'}
        ,{field: 'panduan_num', title: '判断题', align: 'center'}
        ,{field: 'kslianjie', title: '考试链接', align: 'center'}
        ,{align: 'center',field:'caozuo', title: '操作', width:180,toolbar:"#toolbar" ,rowspan: 2}
      ]]
    })//table

    //监听新建按钮
    $('#newst').on('click',function(data){
      let if_index = layer.open({
          skin: 'layui-layer-molv',
          type: 2,
          title: '请填写试题内容',
          shadeClose: false,
          shade: [0.8, '#393D49'],
          offset: '80px',
          maxmin: true, //开启最大化最小化按钮
          area: '850px',
          maxHeight:'900px',
          content: '/manage/new_firststep',
          success: function(layero, index) {
            console.log('layero-->',layero)
            console.log('index-->',index)
            console.log(layer.iframeAuto)
            layer.iframeAuto(index);
          }
        }); 
    })
    //监听工具条
    table.on('tool(sjlb_table)', function(obj){
      console.log('obj-->',obj)
      let data = obj.data;
      console.log('工具条监听-->',data)
      if(obj.event === 'detail'){
        console.log('监听详情-->',data.catid)
        console.log('能取到_id吗-->',data._id)
        //layer.msg('ID：'+ data.catid + ' 的查看操作');
         let if_index = layer.open({
            type: 2,
            title: '查看',
            shadeClose: true,
            shade: false,
            maxmin: true, //开启最大化最小化按钮
            area: ['900px', '600px'],
            content: '/manage/iframe_mb?_id=' + data._id
          }); 
          layer.iframeAuto(if_index);
      } 
      else if(obj.event === 'del'){
        console.log('监听删除-->',data._id)
        layer.confirm('确定要删除该条数据吗?', function(index){
          console.log('删除index-->',index)
          $.ajax({
            url:'/manage/delete_sjlbitem',
            method:'post',
            data:{
              _id:data._id
            },
            success:function(res){
              if(res.code === 0){
                console.log(res.msg)
                obj.del()
                layer.close(index);
              }else{
                console.log('删除失败')
              }
            },
            error:function(err){
              console.log('delete err',err)
            }
          }) 
        });
      } 
      else if(obj.event === 'edit'){
        console.log('编辑-->',JSON.stringify(data))
        //layer.alert('编辑行：<br>'+ JSON.stringify(data))
        let if_index = layer.open({
            skin: 'layui-layer-molv',
            type: 2,
            title: '查看',
            shadeClose: false,
            shade: [0.8, '#393D49'],
            scrollbar: false,
            maxmin: true, //开启最大化最小化按钮
            area: ['900px', '600px'],
            content: '/manage/iframe_mbbj?_id=' + data._id
          }); 
        layer.iframeAuto(if_index);
      }
    });//工具条
  });
})
</script>
